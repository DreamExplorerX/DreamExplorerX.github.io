---
title: C++11伪随机数
date: 2020-07-14 20:11:25
tags: [C++11, random]
categories: [C++11]
index_img: img/c++11伪随机数.jpg
banner_img: img/c++11伪随机数.jpg
---
# C++11 伪随机数

## C风格伪随机数生成
旧版本C/C++使用`rand()`函数生成区间在`[0, RAND_MAX]`的伪随机数，其存在多种问题：无法满足多种应用程序对不同区间范围、不同数值类型或不同分布的需求。而编程人员在编写程序为了解决这些问题通常会转换 rand 生成的随机数的范围、类型或者是分布时，常常会引入非随机性。

## C++11新标准
C++11新标准中提供了新的随机数生成库`<random>`来解决上述问题，`<random>`库主要通过`generator`和`distribution`的协作来生成随机数

* random_device类：可能产生真正的随机数，但依具体实现

* random number engines(随机数生成引擎类): 负责生成原始随机数
* random number distributions(随机数生成分布类): 使得生成的随机数满足统计学中的概率分布
STL预先指定了一系列的生成引擎，并且提供一个default_random_engine。default_random_engine会使用某个预定义的引擎，且不同编译器、不同平台的实现可能不同。

### 非确定性随机数

C++11标准提供了`random_device`类，有可能产生真正的随机数，依赖于具体实现有关。windows平台好像依赖于伪随机生成实现。`std::random_device`是一个非常简单和可靠的随机生成器。该实现是由标准强制执行的，至少在Boost中，它在任何地方都使用相同的代码，这是从原始的`std::mt19937`文件派生而来的。这个代码非常稳定，是跨平台的。您可以非常确信，在任何编译它的平台上，初始化它、从它进行查询等都将编译成类似的代码，并且您将获得类似的性能。

### 随机数生成引擎
C++11标准预先定义了多个算法的随机数生成引擎
![](/img/c++11-predefined-random-number-engines.jpg)

随机数生成引擎定义为函数对象类，即实现了`operator()`运算符函数，`operator()`运算符函数无参数，返回随机生成的`unsigned`数，随机数区间位于`[default_randm_engine::min, default_randm_engine::max]`可通过调用随机数引擎对象生成原始随机数。

```c++
std::default_random_engine e;  // 种子默认
for (int i = 0; i < 10; ++i) {
  std::cout << e() << std::endl;  // 通过调用e()获得下一个随机数
}
```

#### static 引擎和分布

随机数生成引擎在同一初始状态下，会生成相同的随机数序列，这种特性适用于调试情况，若不希望这种情况，可将生成引擎和分布定义为`static`类型，保存其状态，这样多次调用就会不断使用前一个状态生成后续的序列。

注意，一个给定的随机数发生器已知会生成相同的随机数序列。一个函数如果定义了局部的随机数发生器，应该将其（包括引擎和分布对象）定义为 static 的。否则，每次调用函数都会生成相同的序列。


```c++
void bad_generator() {
	cout << "bad engine: ";
	default_random_engine bad_engine;
	uniform_int_distribution<> bad_distribution (1, 10);
	for (int i = 0; i < 10; i++) {
		cout << bad_distribution(bad_engine) << " ";
	}
	cout << endl;
}

void good_generator() {
	cout << "good engine: ";
	static default_random_engine good_engine;
	static uniform_int_distribution<> good_distribution (1, 10);
	for (int i = 0; i < 10; i++) {
		cout << good_distribution(good_engine) << " ";
	}
	cout << endl;
}

int main() {
	bad_generator();  // 输出 bad engine: 1 2 8 5 6 3 1 7 7 10
	bad_generator();  // 输出 bad engine: 1 2 8 5 6 3 1 7 7 10
	cout << "------------------" << endl;
	good_generator();  // 输出 good engine: 1 2 8 5 6 3 1 7 7 10
	good_generator();  // 输出 good engine: 4 6 9 1 1 6 7 1 4 1

	return 0;
}
```





#### 设置随机数种子

随机数生成引擎在同一初始状态下，会生成相同的随机数序列。可以通过设置种子使得其随机数序列不同。存在两种方法修改随机数种子

* 定义随机数引擎类的构造函数
* 调用`seed`函数

```c++
default_random_engine e1;		//默认的种子
default_random_engine e2(100);	        // 构造函数中设定种子
 
default_random_engine e3;  // 默认种子
e3.seed(100);  // 设置种子
```

关于种子，旧版本可能使用`time(NULL)`函数来设定种子，但`time`函数精度为秒，重复调用可能会生成相同的种子。这里可利用上文提到的`random_device`类的特性设置种子

```c++
std::random_device rd;
std::default_random_engine e(rd());
std::uniform_int_distribution<> u(5,20);
for (size_t i = 0; i < 10; i++) {
    cout << u(e) << endl;
}
```

### 随机分布

类似引擎类型，分布类型也是函数对象类，实现了`operator()`函数分布类型处理随机数生成引擎生成的随机数，使其结果满足某种概率分布。

#### 均匀概率分布(默认类型)

```c++
std::default_random_engine e;
std::uniform_int_distribution<> u(5, 20);  // 默认类型为unsigned，指定随机数范围区间[5, 10]
for (int i = 0; i < 10; ++i) {
  std::cout << u(e) << std::endl;  // 传递引擎对象给分布对象，因为某些分布可能需要调用引擎多次才能产生一个值。
}
```

#### 均匀概率分布(实数类型)

```c++
std::default_random_engine e;
std::uniform_real_distribution<> u(0, 1);  // 默认类型为double，指定随机数范围区间[0, 1]
for (int i = 0; i < 10; ++i) {
  std::cout << u(e) << std::endl;  // 传递引擎对象给分布对象，因为某些分布可能需要调用引擎多次才能产生一个值。
}
```

#### 其他非均匀分布

比如伯努利分布、正态分布、抽样分布、泊松分布等。

![](/img/c++11-predefined-random-number-distributions.jpg)



## 参考

* https://en.cppreference.com/w/cpp/numeric/random
* http://www.cplusplus.com/reference/random/

* [Why not just use random_device?](https://stackoverflow.com/questions/39288595/why-not-just-use-random-device)
* [【C++】c++ 11中的随机数 ——random](https://blog.csdn.net/qq_34784753/article/details/79600809)
* [C++11随机数发生器 VS rand()](https://blog.csdn.net/songshiMVP1/article/details/47016805)